#' Plot of HIV prevalence over time
#'
#' Plots the raw and adjusted HIV prevalence over time
#'
#' This function has been developed to plot HIV prevalence over time.  Both the raw and fully adjusted (obtained using the \link[ANCRTAdjust]{data_clean}, \link[ANCRTAdjust]{mt_adjust}
#' and \link[ANCRTAdjust]{impcov_adjust} functions) HIV prevalence can be plotted and compared or just the fully adjusted prevalence can be plotted.  The time unit can be set to 
#' either yearly or by reporting period.
#' 
#' @param Data The dataframe output by \link[ANCRTAdjust]{impcov_adjust}.  The following variables must be present:
#'  \itemize{
#'   \item \code{snu1}: The subnational unit 1.  If plots are to be generated for the different snu1s, the parameter bysnu1 = "TRUE" must 
#'   have been specified when running \link[ANCRTAdjust]{impcov_adjust}.
#'   \item \code{time}: The year and/or quarter that the data was collected.  If plots are to be generated by reporting period, the parameter 
#'   byperiod = "TRUE" must have been specified when running \link[ANCRTAdjust]{impcov_adjust}.  If plots are to be generated by year, the parameter
#'   byyear = "TRUE" must have been specified when running \link[ANCRTAdjust]{impcov_adjust}.
#'   \item \code{Adjusted_prev}: The HIV prevalence adjusted for imperfect testing coverage and all previous adjustments (i.e. data cleaning and adjustment 
#'   for multiple testing, if performed).  Generated using the \link[ANCRTAdjust]{impcov_adjust} function.
#'   \item{HIVraw}: The HIV prevalence using the raw data. Generated using the \link[ANCRTAdjust]{impcov_adjust} function.
#'  }
#' @param snu1 The snu1 for which the plot is generated.  "All" indicates that the plot include the entire country data (i.e. not snu1-specific). Default = "All".
#' @param time.unit "PERIOD" indicates that the results be plotted by reporting period.  "YEAR" indicates that the results be plotted by year. Default = "PERIOD".
#' @param HIVraw "TRUE" indicates that both the fully adjusted and raw HIV prevalences be plotted.  "FALSE" indicates that only the fully
#' adjusted HIV prevalences be plotted. Default = "TRUE".
#' @param y.lim The y-axis upper limit. Default = 40.
#'
#' @import ggplot2
#'
#' @author Mathieu Maheu-Giroux
#' @author Brittany Blouin
#'
#' @return A plot of HIV prevalence over time.
#'
#' @export

plot_rawadjusted <- function(Data, snu1 = "All", time.unit = "PERIOD", HIVraw = "TRUE", y.lim = 40){
  Data$time <- as.numeric(Data$time)
  if(time.unit == "PERIOD" & HIVraw == "TRUE"){
    Plot <-
    ggplot(Data[Data$time < 9000 & Data$snu1 == snu1,], aes(time)) +
    geom_line(aes(y = HIVraw, color = "Raw HIV prevalence"), size=1) + geom_point(aes(y = HIVraw, color = "Raw HIV prevalence"))+
    geom_line(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"), size=1) + geom_point(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"))+
    xlab("time") +
    ylab("HIV Prevalence (%)") +
    ylim(c(0, y.lim))+
    theme(axis.text = element_text(size = 7), axis.title = element_text(size = 7), legend.position = "right")+
    scale_colour_manual(name="",
                      values=c("Adjusted HIV prevalence"="blue", "Raw HIV prevalence"="red"))
    return(Plot)
  }
  
  if(time.unit == "YEAR" & HIVraw == "TRUE"){
    if(max(Data$time) > 9999){
      Data <- Data[Data$time > 9999,]
      Data$time <- substr(Data$time, 1, 4)
      Data$time <- as.numeric(Data$time)
    }
    if(max(Data$time) <= 9999){
      Data <- Data[Data$time < 9999,]
      Data$time <- as.numeric(Data$time)
    }
    Plot2 <-
      ggplot(Data[Data$snu1 == snu1,], aes(time)) +
      geom_line(aes(y = HIVraw, color = "Raw HIV prevalence"), size=1) + geom_point(aes(y = HIVraw, color = "Raw HIV prevalence"))+
      geom_line(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"), size=1) + geom_point(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"))+
      xlab("time") +
      ylab("HIV Prevalence (%)") +
      ylim(c(0, y.lim))+
      theme(axis.text = element_text(size = 7), axis.title = element_text(size = 7), legend.position = "right")+
      scale_colour_manual(name="",
                          values=c("Adjusted HIV prevalence"="blue", "Raw HIV prevalence"="red"))
    return(Plot2)
  }
  
  if(time.unit == "PERIOD" & HIVraw == "FALSE"){
    Plot3 <-
      ggplot(Data[Data$time < 9000 & Data$snu1 == snu1,], aes(time)) +
      geom_line(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"), size=1) + geom_point(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"))+
      xlab("time") +
      ylab("HIV Prevalence (%)") +
      ylim(c(0, y.lim))+
      theme(axis.text = element_text(size = 7), axis.title = element_text(size = 7), legend.position = "none")+
      scale_colour_manual(name="", values=c("Adjusted HIV prevalence"="blue"))
    return(Plot3)
  }
  
  if(time.unit == "YEAR" & HIVraw == "FALSE"){
    if(max(Data$time) > 9999){
      Data <- Data[Data$time > 9999,]
      Data$time <- substr(Data$time, 1, 4)
      Data$time <- as.numeric(Data$time)
    }
    if(max(Data$time) <= 9999){
      Data <- Data[Data$time < 9999,]
      Data$time <- as.numeric(Data$time)
    }
    Plot4 <-
      ggplot(Data[Data$snu1 == snu1,], aes(time)) +
      geom_line(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"), size=1) + geom_point(aes(y = Adjusted_prev, color = "Adjusted HIV prevalence"))+
      xlab("time") +
      ylab("HIV Prevalence (%)") +
      ylim(c(0, y.lim))+
      theme(axis.text = element_text(size = 7), axis.title = element_text(size = 7), legend.position = "none")+
      scale_colour_manual(name="", values=c("Adjusted HIV prevalence"="blue"))
    return(Plot4)
  }

}
